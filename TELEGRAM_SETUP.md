# Настройка Telegram авторизации для AuxChat

## Шаг 1: Создание Telegram бота

1. Откройте Telegram и найдите **@BotFather**
2. Отправьте команду `/newbot`
3. Придумайте имя для бота (например: "AuxChat Login Bot")
4. Придумайте username для бота (должен заканчиваться на `bot`, например: `auxchat_login_bot`)
5. BotFather пришлёт вам токен вида: `1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`

## Шаг 2: Добавление токена в секреты

1. Скопируйте токен бота
2. В интерфейсе poehali.dev найдите секрет `TELEGRAM_BOT_TOKEN`
3. Вставьте токен в поле и сохраните

## Шаг 3: Обновление кода

1. Откройте файл `src/pages/Index.tsx`
2. Найдите строку:
   ```typescript
   botUsername="auxchat_login_bot"
   ```
3. Замените `auxchat_login_bot` на username вашего бота

## Шаг 4: Настройка домена бота (опционально)

Если вы публикуете сайт на своём домене:

1. Откройте @BotFather
2. Отправьте `/setdomain`
3. Выберите вашего бота
4. Укажите домен вашего сайта (например: `example.com`)

## Проверка работы

1. Откройте сайт
2. Нажмите "Войти" → вкладка "Telegram"
3. Должна появиться синяя кнопка "Login with Telegram"
4. При нажатии откроется окно авторизации Telegram
5. После подтверждения вы автоматически войдёте в чат

## Отладка

Если кнопка не появляется или авторизация не работает:

1. Откройте консоль браузера (F12)
2. Перейдите на вкладку Console
3. Попробуйте нажать кнопку авторизации
4. Проверьте сообщения об ошибках:
   - "Bot token not configured" → не добавлен TELEGRAM_BOT_TOKEN
   - "Invalid authentication data" → неверный токен или подпись
   - Ошибка 404 → неверный username бота

## Безопасность

- Токен бота **НИКОГДА** не должен попадать в frontend код
- Вся проверка подписи происходит на backend
- Данные пользователя сохраняются в базу данных только после проверки

## Как это работает

1. Frontend отображает официальный Telegram Login Widget
2. Пользователь нажимает кнопку → Telegram запрашивает подтверждение
3. Telegram возвращает данные пользователя + криптографическую подпись
4. Frontend отправляет данные на backend функцию
5. Backend проверяет подпись используя HMAC-SHA256 и секретный ключ
6. Если подпись валидна → пользователь создаётся/обновляется в базе
7. Frontend получает данные пользователя и авторизует его

## Техническая информация

- **Backend функция**: `/backend/telegram-auth/index.py`
- **URL**: `https://functions.poehali.dev/1010306b-8aa0-4c54-828b-5427008a0172`
- **Метод**: POST
- **База данных**: таблица `users` с полями telegram_id, username, avatar_url, energy
- **Проверка подписи**: HMAC-SHA256(data, SHA256(bot_token))
