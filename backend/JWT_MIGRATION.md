# JWT Authentication Migration Guide

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å?

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ **JWT —Ç–æ–∫–µ–Ω–æ–≤** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ `X-User-Id`.

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ JWT:

‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–¥–¥–µ–ª–∞—Ç—å —Ç–æ–∫–µ–Ω –±–µ–∑ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞  
‚úÖ **–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è** - —Ç–æ–∫–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å—Ç–µ–∫–∞—é—Ç —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π  
‚úÖ **–ë–µ–∑ –ë–î** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø—Ä–æ—Å–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö  
‚úÖ **–°—Ç–∞–Ω–¥–∞—Ä—Ç** - JWT –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ 90% —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö API  

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### 1. –í—Ö–æ–¥ (Login)
```python
# backend/login/index.py
token = jwt.encode({
    'user_id': 7,
    'username': 'AuxChat',
    'is_admin': False,
    'exp': datetime.utcnow() + timedelta(days=30)
}, jwt_secret, algorithm='HS256')

return {'token': token, ...}
```

### 2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
```javascript
// src/pages/Index.tsx
localStorage.setItem('auxchat_token', data.token);
```

### 3. –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö
```javascript
// src/lib/api.ts
headers: {
  'Authorization': `Bearer ${token}`,
  'X-User-Id': userId  // –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
}
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ
```python
# backend/jwt_utils.py
from jwt_utils import get_user_id_from_request

user_id = get_user_id_from_request(event)  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç JWT –∏–ª–∏ X-User-Id
```

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

‚úÖ **–°—Ç–∞—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å X-User-Id –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å**  
‚úÖ **–ù–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç JWT —Ç–æ–∫–µ–Ω—ã**  
‚úÖ **–ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –±–µ–∑ breaking changes**  

## –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

- ‚úÖ `backend/login/index.py` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT —Ç–æ–∫–µ–Ω
- ‚úÖ `backend/register/index.py` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT —Ç–æ–∫–µ–Ω
- ‚úÖ `src/lib/api.ts` - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
- ‚úÖ `src/pages/Index.tsx` - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

1. –û–±–Ω–æ–≤–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `jwt_utils.py`
2. –î–æ–±–∞–≤–∏—Ç—å refresh —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–æ–¥–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏
3. –î–æ–±–∞–≤–∏—Ç—å blacklist –¥–ª—è –æ—Ç–∑—ã–≤–∞ —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–∏ logout
4. –î–æ–±–∞–≤–∏—Ç—å rate limiting –ø–æ —Ç–æ–∫–µ–Ω–∞–º

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö:

```python
from jwt_utils import get_user_id_from_request

def handler(event, context):
    user_id = get_user_id_from_request(event)
    
    if not user_id:
        return {
            'statusCode': 401,
            'body': json.dumps({'error': 'Unauthorized'})
        }
    
    # –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É...
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

üîê **JWT_SECRET** —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è  
üîê –¢–æ–∫–µ–Ω—ã –∏—Å—Ç–µ–∫–∞—é—Ç —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π  
üîê –¢–æ–∫–µ–Ω—ã –ø–æ–¥–ø–∏—Å–∞–Ω—ã –∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω—ã  
üîê Fallback –Ω–∞ X-User-Id –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏  
